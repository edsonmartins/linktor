(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3386],{24059:(e,s,t)=>{Promise.resolve().then(t.bind(t,15515))},15515:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>eg});var a=t(95155),l=t(12115),n=t(76046),i=t(35906),r=t(39556),d=t(25848),o=t(87364),c=t(6118),m=t(14505),x=t(22725),u=t(29191),p=t(87780),h=t(73312),f=t(25121),g=t(87081),j=t(85534),N=t(61556),b=t(24708),v=t(31077);t(66419);var w=t(63348),y=t(70865),A=t(21567);let k=(0,l.memo)(function(e){let{data:s}=e,{content:t,isStart:l,isSelected:n}=s;return(0,a.jsxs)("div",{className:(0,A.cn)("rounded-lg border-2 bg-white p-4 shadow-sm transition-shadow min-w-[200px] max-w-[280px]",n?"border-blue-500 shadow-md":"border-blue-200",l&&"ring-2 ring-green-500 ring-offset-2"),children:[(0,a.jsx)(v.h7,{type:"target",position:b.yX.Top,className:"!bg-blue-500 !w-3 !h-3"}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)("div",{className:"rounded-md bg-blue-100 p-1.5",children:(0,a.jsx)(w.A,{className:"h-4 w-4 text-blue-600"})}),(0,a.jsx)("span",{className:"text-sm font-medium text-blue-700",children:"Message"}),l&&(0,a.jsx)(y.A,{className:"h-3 w-3 text-green-500 fill-green-500 ml-auto"})]}),(0,a.jsx)("p",{className:"text-sm text-gray-600 line-clamp-3",children:t||"Click to edit message..."}),(0,a.jsx)(v.h7,{type:"source",position:b.yX.Bottom,className:"!bg-blue-500 !w-3 !h-3"})]})});var C=t(86835);let _=(0,l.memo)(function(e){let{data:s}=e,{content:t,quick_replies:l,isStart:n,isSelected:i}=s;return(0,a.jsxs)("div",{className:(0,A.cn)("rounded-lg border-2 bg-white p-4 shadow-sm transition-shadow min-w-[200px] max-w-[280px]",i?"border-purple-500 shadow-md":"border-purple-200",n&&"ring-2 ring-green-500 ring-offset-2"),children:[(0,a.jsx)(v.h7,{type:"target",position:b.yX.Top,className:"!bg-purple-500 !w-3 !h-3"}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)("div",{className:"rounded-md bg-purple-100 p-1.5",children:(0,a.jsx)(C.A,{className:"h-4 w-4 text-purple-600"})}),(0,a.jsx)("span",{className:"text-sm font-medium text-purple-700",children:"Question"}),n&&(0,a.jsx)(y.A,{className:"h-3 w-3 text-green-500 fill-green-500 ml-auto"})]}),(0,a.jsx)("p",{className:"text-sm text-gray-600 line-clamp-2 mb-2",children:t||"Click to edit question..."}),l&&l.length>0&&(0,a.jsxs)("div",{className:"flex flex-wrap gap-1 mt-2",children:[l.slice(0,3).map(e=>(0,a.jsx)("span",{className:"inline-block px-2 py-0.5 text-xs bg-purple-50 text-purple-700 rounded-full border border-purple-200",children:e.title},e.id)),l.length>3&&(0,a.jsxs)("span",{className:"text-xs text-gray-400",children:["+",l.length-3," more"]})]}),(0,a.jsx)(v.h7,{type:"source",position:b.yX.Bottom,className:"!bg-purple-500 !w-3 !h-3"})]})});var E=t(87694);let q=(0,l.memo)(function(e){let{data:s}=e,{content:t,transitions:l,isStart:n,isSelected:i}=s;return(0,a.jsxs)("div",{className:(0,A.cn)("rounded-lg border-2 bg-white p-4 shadow-sm transition-shadow min-w-[200px] max-w-[280px]",i?"border-amber-500 shadow-md":"border-amber-200",n&&"ring-2 ring-green-500 ring-offset-2"),children:[(0,a.jsx)(v.h7,{type:"target",position:b.yX.Top,className:"!bg-amber-500 !w-3 !h-3"}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)("div",{className:"rounded-md bg-amber-100 p-1.5",children:(0,a.jsx)(E.A,{className:"h-4 w-4 text-amber-600"})}),(0,a.jsx)("span",{className:"text-sm font-medium text-amber-700",children:"Condition"}),n&&(0,a.jsx)(y.A,{className:"h-3 w-3 text-green-500 fill-green-500 ml-auto"})]}),(0,a.jsx)("p",{className:"text-sm text-gray-600 line-clamp-2 mb-2",children:t||"Click to edit condition..."}),l&&l.length>0&&(0,a.jsxs)("div",{className:"text-xs text-gray-400 mt-2",children:[l.length," ",1===l.length?"branch":"branches"]}),(0,a.jsx)(v.h7,{type:"source",position:b.yX.Bottom,className:"!bg-amber-500 !w-3 !h-3"})]})});var S=t(45471),R=t(57517),z=t(23950),T=t(67072),F=t(86122);let P={tag:(0,a.jsx)(S.A,{className:"h-3 w-3"}),assign:(0,a.jsx)(R.A,{className:"h-3 w-3"}),escalate:(0,a.jsx)(z.A,{className:"h-3 w-3"}),set_entity:(0,a.jsx)(T.A,{className:"h-3 w-3"}),http_call:(0,a.jsx)(F.A,{className:"h-3 w-3"})},$={tag:"Add Tag",assign:"Assign",escalate:"Escalate",set_entity:"Set Entity",http_call:"HTTP Call"},D=(0,l.memo)(function(e){let{data:s}=e,{content:t,actions:l,isStart:n,isSelected:i}=s;return(0,a.jsxs)("div",{className:(0,A.cn)("rounded-lg border-2 bg-white p-4 shadow-sm transition-shadow min-w-[200px] max-w-[280px]",i?"border-emerald-500 shadow-md":"border-emerald-200",n&&"ring-2 ring-green-500 ring-offset-2"),children:[(0,a.jsx)(v.h7,{type:"target",position:b.yX.Top,className:"!bg-emerald-500 !w-3 !h-3"}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)("div",{className:"rounded-md bg-emerald-100 p-1.5",children:(0,a.jsx)(T.A,{className:"h-4 w-4 text-emerald-600"})}),(0,a.jsx)("span",{className:"text-sm font-medium text-emerald-700",children:"Action"}),n&&(0,a.jsx)(y.A,{className:"h-3 w-3 text-green-500 fill-green-500 ml-auto"})]}),t&&(0,a.jsx)("p",{className:"text-sm text-gray-600 line-clamp-2 mb-2",children:t}),l&&l.length>0&&(0,a.jsx)("div",{className:"flex flex-wrap gap-1 mt-2",children:l.map((e,s)=>(0,a.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 text-xs bg-emerald-50 text-emerald-700 rounded-full border border-emerald-200",children:[P[e.type],$[e.type]]},s))}),(0,a.jsx)(v.h7,{type:"source",position:b.yX.Bottom,className:"!bg-emerald-500 !w-3 !h-3"})]})});var H=t(54216);let M={message:k,question:_,condition:q,action:D,end:(0,l.memo)(function(e){let{data:s}=e,{isSelected:t}=s;return(0,a.jsxs)("div",{className:(0,A.cn)("rounded-lg border-2 bg-white p-4 shadow-sm transition-shadow min-w-[120px]",t?"border-red-500 shadow-md":"border-red-200"),children:[(0,a.jsx)(v.h7,{type:"target",position:b.yX.Top,className:"!bg-red-500 !w-3 !h-3"}),(0,a.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,a.jsx)("div",{className:"rounded-md bg-red-100 p-1.5",children:(0,a.jsx)(H.A,{className:"h-4 w-4 text-red-600"})}),(0,a.jsx)("span",{className:"text-sm font-medium text-red-700",children:"End"})]})]})})};function I(e){let{nodes:s,startNodeId:t,selectedNodeId:n,onNodesChange:i,onNodeSelect:r}=e,d=(0,l.useMemo)(()=>s.map(e=>{var s,a;return s=e.id===t,a=e.id===n,{id:e.id,type:e.type,position:e.position||{x:0,y:0},data:{...e,isStart:s,isSelected:a},selected:a}}),[s,t,n]),o=(0,l.useMemo)(()=>(function(e){let s=[];return e.forEach(e=>{e.transitions.forEach((t,a)=>{s.push({id:"".concat(e.id,"-").concat(t.to_node_id,"-").concat(a),source:e.id,target:t.to_node_id,label:"default"!==t.condition?t.value||t.condition:void 0,markerEnd:{type:b.TG.ArrowClosed,width:20,height:20},style:{strokeWidth:2},labelStyle:{fontSize:12,fontWeight:500},labelBgStyle:{fill:"#fff",fillOpacity:.9}})})}),s})(s),[s]),[c,m,x]=(0,v.ck)(d),[u,p,h]=(0,v.fM)(o);(0,l.useMemo)(()=>{m(d)},[d,m]),(0,l.useMemo)(()=>{p(o)},[o,p]);let f=(0,l.useCallback)(e=>{x(e),e.filter(e=>"position"===e.type&&!1===e.dragging).length>0&&setTimeout(()=>{let e=function(e,s){let t=new Map;return s.forEach(e=>{e.position&&t.set(e.id,e.position)}),e.map(e=>{let s=t.get(e.id);return s?{...e,position:s}:e})}(s,c);JSON.stringify(e)!==JSON.stringify(s)&&i(e)},0)},[x,s,c,i]),g=(0,l.useCallback)(e=>{h(e)},[h]),j=(0,l.useCallback)(e=>{e.source&&e.target&&i(s.map(s=>s.id===e.source?s.transitions.some(s=>s.to_node_id===e.target)?s:{...s,transitions:[...s.transitions,{id:"trans-".concat(Date.now()),to_node_id:e.target,condition:"default"}]}:s))},[s,i]),N=(0,l.useCallback)((e,s)=>{r(s.id)},[r]),w=(0,l.useCallback)(()=>{r(null)},[r]);return(0,a.jsx)("div",{className:"h-full w-full",children:(0,a.jsxs)(v.Gc,{nodes:c,edges:u,onNodesChange:f,onEdgesChange:g,onConnect:j,onNodeClick:N,onPaneClick:w,nodeTypes:M,fitView:!0,snapToGrid:!0,snapGrid:[15,15],defaultEdgeOptions:{type:"smoothstep"},proOptions:{hideAttribution:!0},children:[(0,a.jsx)(v.VS,{gap:15,size:1}),(0,a.jsx)(v.H2,{}),(0,a.jsx)(v.of,{nodeStrokeColor:e=>{var s;return(null===(s=e.data)||void 0===s?void 0:s.isStart)?"#22c55e":"end"===e.type?"#ef4444":"#64748b"},nodeColor:e=>{var s;return(null===(s=e.data)||void 0===s?void 0:s.isStart)?"#dcfce7":"end"===e.type?"#fee2e2":"#f1f5f9"},nodeBorderRadius:8})]})})}var J=t(40767),O=t(33473),V=t(45686),B=t(33900),U=t(98986),L=t(46754),X=t(37528),K=t(15157),Q=t(77995);let G={message:{icon:(0,a.jsx)(w.A,{className:"h-4 w-4"}),label:"Message"},question:{icon:(0,a.jsx)(C.A,{className:"h-4 w-4"}),label:"Question"},condition:{icon:(0,a.jsx)(E.A,{className:"h-4 w-4"}),label:"Condition"},action:{icon:(0,a.jsx)(T.A,{className:"h-4 w-4"}),label:"Action"},end:{icon:(0,a.jsx)(H.A,{className:"h-4 w-4"}),label:"End"}},Y=[{value:"tag",label:"Add Tag"},{value:"assign",label:"Assign to User"},{value:"escalate",label:"Escalate"},{value:"set_entity",label:"Set Entity"},{value:"http_call",label:"HTTP Call"}],W=[{value:"default",label:"Default (always)"},{value:"reply_equals",label:"Reply equals"},{value:"contains",label:"Contains"},{value:"regex",label:"Regex match"}];function Z(e){var s,t;let{node:n,allNodes:i,onUpdate:r,onDelete:d,onClose:o}=e,[c,m]=(0,l.useState)(n);(0,l.useEffect)(()=>{m(n)},[n]);let x=e=>{let s={...c,...e};m(s),r(s)},u=(e,s)=>{let t=[...c.quick_replies||[]];t[e]={...t[e],...s},x({quick_replies:t})},p=e=>{let s=[...c.quick_replies||[]];s.splice(e,1),x({quick_replies:s})},f=(e,s)=>{let t=[...c.transitions];t[e]={...t[e],...s},x({transitions:t})},g=e=>{let s=[...c.transitions];s.splice(e,1),x({transitions:s})},j=(e,s)=>{let t=[...c.actions||[]];t[e]={...t[e],...s},x({actions:t})},N=e=>{let s=[...c.actions||[]];s.splice(e,1),x({actions:s})},b=i.filter(e=>e.id!==n.id),v=G[c.type];return(0,a.jsxs)("div",{className:"w-80 border-l bg-background flex flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[v.icon,(0,a.jsxs)("span",{className:"font-medium",children:[v.label," Node"]})]}),(0,a.jsx)(h.$,{variant:"ghost",size:"icon",onClick:o,children:(0,a.jsx)(J.A,{className:"h-4 w-4"})})]}),(0,a.jsx)(Q.F,{className:"flex-1",children:(0,a.jsxs)("div",{className:"p-4 space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(U.J,{className:"text-muted-foreground text-xs",children:"Node ID"}),(0,a.jsx)("code",{className:"text-xs bg-muted px-2 py-1 rounded block",children:c.id})]}),"end"!==c.type&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(U.J,{htmlFor:"content",children:"Content"}),(0,a.jsx)(L.T,{id:"content",value:c.content,onChange:e=>x({content:e.target.value}),placeholder:"Enter message content...",rows:3})]}),"question"===c.type&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(K.w,{}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(U.J,{children:"Quick Replies"}),(0,a.jsxs)(h.$,{variant:"outline",size:"sm",onClick:()=>{let e={id:"reply-".concat(Date.now()),title:"New option"};x({quick_replies:[...c.quick_replies||[],e]})},children:[(0,a.jsx)(O.A,{className:"h-3 w-3 mr-1"}),"Add"]})]}),null===(s=c.quick_replies)||void 0===s?void 0:s.map((e,s)=>(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(B.p,{value:e.title,onChange:e=>u(s,{title:e.target.value}),placeholder:"Button text",className:"flex-1"}),(0,a.jsx)(h.$,{variant:"ghost",size:"icon",onClick:()=>p(s),children:(0,a.jsx)(V.A,{className:"h-3 w-3 text-destructive"})})]},e.id))]})]}),"action"===c.type&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(K.w,{}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(U.J,{children:"Actions"}),(0,a.jsxs)(h.$,{variant:"outline",size:"sm",onClick:()=>{x({actions:[...c.actions||[],{type:"tag",config:{}}]})},children:[(0,a.jsx)(O.A,{className:"h-3 w-3 mr-1"}),"Add"]})]}),null===(t=c.actions)||void 0===t?void 0:t.map((e,s)=>(0,a.jsxs)("div",{className:"space-y-2 p-3 border rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(X.l6,{value:e.type,onValueChange:e=>j(s,{type:e}),children:[(0,a.jsx)(X.bq,{className:"flex-1",children:(0,a.jsx)(X.yv,{})}),(0,a.jsx)(X.gC,{children:Y.map(e=>(0,a.jsx)(X.eb,{value:e.value,children:e.label},e.value))})]}),(0,a.jsx)(h.$,{variant:"ghost",size:"icon",onClick:()=>N(s),children:(0,a.jsx)(V.A,{className:"h-3 w-3 text-destructive"})})]}),"tag"===e.type&&(0,a.jsx)(B.p,{value:e.config.tag||"",onChange:t=>j(s,{config:{...e.config,tag:t.target.value}}),placeholder:"Tag name"}),"escalate"===e.type&&(0,a.jsxs)(X.l6,{value:e.config.priority||"normal",onValueChange:t=>j(s,{config:{...e.config,priority:t}}),children:[(0,a.jsx)(X.bq,{children:(0,a.jsx)(X.yv,{placeholder:"Priority"})}),(0,a.jsxs)(X.gC,{children:[(0,a.jsx)(X.eb,{value:"low",children:"Low"}),(0,a.jsx)(X.eb,{value:"normal",children:"Normal"}),(0,a.jsx)(X.eb,{value:"high",children:"High"}),(0,a.jsx)(X.eb,{value:"urgent",children:"Urgent"})]})]})]},s))]})]}),"end"!==c.type&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(K.w,{}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(U.J,{children:"Transitions"}),(0,a.jsxs)(h.$,{variant:"outline",size:"sm",onClick:()=>{let e={id:"trans-".concat(Date.now()),to_node_id:"",condition:"default"};x({transitions:[...c.transitions,e]})},children:[(0,a.jsx)(O.A,{className:"h-3 w-3 mr-1"}),"Add"]})]}),c.transitions.map((e,s)=>(0,a.jsxs)("div",{className:"space-y-2 p-3 border rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(X.l6,{value:e.to_node_id||"",onValueChange:e=>f(s,{to_node_id:e}),children:[(0,a.jsx)(X.bq,{className:"flex-1",children:(0,a.jsx)(X.yv,{placeholder:"Select target node"})}),(0,a.jsx)(X.gC,{children:b.map(e=>{var s;return(0,a.jsxs)(X.eb,{value:e.id,children:[e.type,": ",(null===(s=e.content)||void 0===s?void 0:s.substring(0,20))||e.id]},e.id)})})]}),(0,a.jsx)(h.$,{variant:"ghost",size:"icon",onClick:()=>g(s),children:(0,a.jsx)(V.A,{className:"h-3 w-3 text-destructive"})})]}),(0,a.jsxs)(X.l6,{value:e.condition,onValueChange:e=>f(s,{condition:e}),children:[(0,a.jsx)(X.bq,{children:(0,a.jsx)(X.yv,{})}),(0,a.jsx)(X.gC,{children:W.map(e=>(0,a.jsx)(X.eb,{value:e.value,children:e.label},e.value))})]}),"default"!==e.condition&&(0,a.jsx)(B.p,{value:e.value||"",onChange:e=>f(s,{value:e.target.value}),placeholder:"Match value"})]},e.id)),0===c.transitions.length&&(0,a.jsx)("p",{className:"text-sm text-muted-foreground text-center py-2",children:"No transitions. Add one or connect nodes on the canvas."})]})]})]})}),(0,a.jsx)("div",{className:"p-4 border-t",children:(0,a.jsxs)(h.$,{variant:"destructive",className:"w-full",onClick:d,children:[(0,a.jsx)(V.A,{className:"h-4 w-4 mr-2"}),"Delete Node"]})})]})}var ee=t(7410),es=t(81556),et=t(1466),ea=t(28283),el=t(84276),en=t(31027);let ei=el.bL;el.l9,el.bm;let er=el.ZL,ed=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(el.hJ,{className:(0,A.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...l,ref:s})});ed.displayName=el.hJ.displayName;let eo=(0,en.F)("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500 data-[state=open]:animate-in data-[state=closed]:animate-out",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),ec=l.forwardRef((e,s)=>{let{side:t="right",className:l,children:n,...i}=e;return(0,a.jsxs)(er,{children:[(0,a.jsx)(ed,{}),(0,a.jsxs)(el.UC,{ref:s,className:(0,A.cn)(eo({side:t}),l),...i,children:[(0,a.jsxs)(el.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[(0,a.jsx)(J.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]}),n]})]})});ec.displayName=el.UC.displayName;let em=e=>{let{className:s,...t}=e;return(0,a.jsx)("div",{className:(0,A.cn)("flex flex-col space-y-2 text-center sm:text-left",s),...t})};em.displayName="SheetHeader";let ex=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(el.hE,{ref:s,className:(0,A.cn)("text-lg font-semibold text-foreground",t),...l})});function eu(e){let{flowId:s,open:t,onOpenChange:n}=e,[i,r]=(0,l.useState)([]),[o,c]=(0,l.useState)(""),[m,x]=(0,l.useState)(null),[u,p]=(0,l.useState)(!1),g=(0,l.useRef)(null),N=(0,d.n)({mutationFn:e=>j.FH.post("/flows/".concat(s,"/test"),{inputs:e}),onSuccess:e=>{let s=e.results||[],t=[];s.forEach(e=>{e.content&&t.push({id:"bot-".concat(Date.now(),"-").concat(Math.random()),type:"bot",content:e.content,quickReplies:e.quick_replies,nodeId:e.node_id,timestamp:new Date}),x(e.next_node_id||null),p(e.flow_ended)}),r(e=>[...e,...t])}});(0,l.useEffect)(()=>{g.current&&(g.current.scrollTop=g.current.scrollHeight)},[i]),(0,l.useEffect)(()=>{t&&0===i.length&&w()},[t]);let b=e=>{let s=e||o.trim();s&&!u&&(r(e=>[...e,{id:"user-".concat(Date.now()),type:"user",content:s,timestamp:new Date}]),c(""),N.mutate([s]))},v=e=>{b(e.value||e.title)},w=()=>{r([]),x(null),p(!1),N.mutate([""])};return(0,a.jsx)(ei,{open:t,onOpenChange:n,children:(0,a.jsxs)(ec,{className:"w-[400px] sm:w-[450px] flex flex-col p-0",children:[(0,a.jsxs)(em,{className:"p-4 border-b",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)(ex,{className:"flex items-center gap-2",children:[(0,a.jsx)(ee.A,{className:"h-5 w-5"}),"Test Flow"]}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsxs)(h.$,{variant:"outline",size:"sm",onClick:w,children:[(0,a.jsx)(es.A,{className:"h-3 w-3 mr-1"}),"Reset"]})})]}),m&&(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,a.jsx)("span",{children:"Current node:"}),(0,a.jsx)("code",{className:"bg-muted px-1.5 py-0.5 rounded text-xs",children:m})]})]}),(0,a.jsx)(Q.F,{className:"flex-1 p-4",ref:g,children:(0,a.jsxs)("div",{className:"space-y-4",children:[i.map(e=>(0,a.jsx)("div",{className:"flex ".concat("user"===e.type?"justify-end":"justify-start"),children:(0,a.jsxs)("div",{className:"max-w-[80%] rounded-lg p-3 ".concat("user"===e.type?"bg-primary text-primary-foreground":"bg-muted"),children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:["bot"===e.type?(0,a.jsx)(ee.A,{className:"h-3 w-3"}):(0,a.jsx)(et.A,{className:"h-3 w-3"}),(0,a.jsx)("span",{className:"text-xs opacity-70",children:"bot"===e.type?"Bot":"You"}),e.nodeId&&(0,a.jsx)(f.E,{variant:"outline",className:"text-[10px] h-4",children:e.nodeId})]}),(0,a.jsx)("p",{className:"text-sm whitespace-pre-wrap",children:e.content}),e.quickReplies&&e.quickReplies.length>0&&(0,a.jsx)("div",{className:"flex flex-wrap gap-2 mt-2",children:e.quickReplies.map(e=>(0,a.jsx)(h.$,{variant:"secondary",size:"sm",className:"h-7 text-xs",onClick:()=>v(e),disabled:u||N.isPending,children:e.title},e.id))})]})},e.id)),N.isPending&&(0,a.jsx)("div",{className:"flex justify-start",children:(0,a.jsxs)("div",{className:"bg-muted rounded-lg p-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(ee.A,{className:"h-3 w-3"}),(0,a.jsx)("span",{className:"text-xs opacity-70",children:"Bot is typing..."})]}),(0,a.jsxs)("div",{className:"flex gap-1 mt-2",children:[(0,a.jsx)("span",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),(0,a.jsx)("span",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),(0,a.jsx)("span",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})]})}),u&&(0,a.jsxs)("div",{className:"text-center py-4",children:[(0,a.jsx)(f.E,{variant:"secondary",children:"Flow ended"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-2",children:"The conversation flow has completed."}),(0,a.jsxs)(h.$,{variant:"outline",size:"sm",className:"mt-2",onClick:w,children:[(0,a.jsx)(es.A,{className:"h-3 w-3 mr-1"}),"Start Over"]})]})]})}),(0,a.jsx)("div",{className:"p-4 border-t",children:(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(B.p,{value:o,onChange:e=>c(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),b())},placeholder:u?"Flow ended":"Type a message...",disabled:u||N.isPending}),(0,a.jsx)(h.$,{onClick:()=>b(),disabled:!o.trim()||u||N.isPending,children:(0,a.jsx)(ea.A,{className:"h-4 w-4"})})]})})]})})}ex.displayName=el.hE.displayName,l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(el.VY,{ref:s,className:(0,A.cn)("text-sm text-muted-foreground",t),...l})}).displayName=el.VY.displayName;var ep=t(53601);let eh=[{type:"message",icon:(0,a.jsx)(w.A,{className:"h-5 w-5"}),label:"Message",description:"Send a message to the user"},{type:"question",icon:(0,a.jsx)(C.A,{className:"h-5 w-5"}),label:"Question",description:"Ask a question with quick reply options"},{type:"condition",icon:(0,a.jsx)(E.A,{className:"h-5 w-5"}),label:"Condition",description:"Branch based on user response"},{type:"action",icon:(0,a.jsx)(T.A,{className:"h-5 w-5"}),label:"Action",description:"Execute actions like tagging or escalation"},{type:"end",icon:(0,a.jsx)(H.A,{className:"h-5 w-5"}),label:"End",description:"End the flow"}];function ef(e){let{onAddNode:s}=e;return(0,a.jsx)(ep.Bc,{children:(0,a.jsxs)("div",{className:"w-16 border-r bg-muted/30 p-2 flex flex-col gap-2",children:[(0,a.jsx)("div",{className:"text-xs font-medium text-muted-foreground text-center mb-2",children:"Nodes"}),eh.map(e=>(0,a.jsxs)(ep.m_,{children:[(0,a.jsx)(ep.k$,{asChild:!0,children:(0,a.jsx)(h.$,{variant:"outline",size:"icon",className:"h-10 w-10",onClick:()=>s(e.type),children:e.icon})}),(0,a.jsxs)(ep.ZI,{side:"right",children:[(0,a.jsx)("div",{className:"text-sm font-medium",children:e.label}),(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:e.description})]})]},e.type))]})})}function eg(){let e=(0,n.useParams)(),s=(0,n.useRouter)(),t=(0,n.useSearchParams)(),b=(0,i.jE)(),v=e.flowId,w="true"===t.get("test"),[y,A]=(0,l.useState)(null),[k,C]=(0,l.useState)([]),[_,E]=(0,l.useState)(!1),[q,S]=(0,l.useState)(w),{data:R,isLoading:z}=(0,r.I)({queryKey:N.lH.flows.detail(v),queryFn:()=>j.FH.get("/flows/".concat(v)),enabled:!!v});(0,l.useEffect)(()=>{(null==R?void 0:R.nodes)&&(C(R.nodes),E(!1))},[R]);let T=(0,d.n)({mutationFn:e=>j.FH.put("/flows/".concat(v),e),onSuccess:()=>{b.invalidateQueries({queryKey:N.lH.flows.detail(v)}),E(!1)}}),F=(0,d.n)({mutationFn:()=>(null==R?void 0:R.is_active)?j.FH.post("/flows/".concat(v,"/deactivate")):j.FH.post("/flows/".concat(v,"/activate")),onSuccess:()=>{b.invalidateQueries({queryKey:N.lH.flows.detail(v)}),b.invalidateQueries({queryKey:N.lH.flows.all})}}),P=(0,l.useCallback)(e=>{C(e),E(!0)},[]),$=e=>{C(k.filter(s=>s.id!==e).map(s=>({...s,transitions:s.transitions.filter(s=>s.to_node_id!==e)}))),A(null),E(!0)},D=k.find(e=>e.id===y)||null;return z?(0,a.jsxs)("div",{className:"flex h-full flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between border-b px-4 py-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)(g.EA,{className:"h-8 w-8"}),(0,a.jsx)(g.EA,{className:"h-6 w-48"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(g.EA,{className:"h-9 w-20"}),(0,a.jsx)(g.EA,{className:"h-9 w-20"})]})]}),(0,a.jsx)("div",{className:"flex-1 p-4",children:(0,a.jsx)(g.EA,{className:"h-full w-full"})})]}):R?(0,a.jsxs)("div",{className:"flex h-full flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between border-b px-4 py-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)(h.$,{variant:"ghost",size:"icon",onClick:()=>s.push("/flows"),children:(0,a.jsx)(o.A,{className:"h-4 w-4"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-lg font-medium",children:R.name}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,a.jsx)(f.E,{variant:R.is_active?"default":"secondary",className:"text-xs",children:R.is_active?"Active":"Inactive"}),_&&(0,a.jsx)(f.E,{variant:"outline",className:"text-xs",children:"Unsaved changes"})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(h.$,{variant:"outline",size:"sm",onClick:()=>S(!0),children:[(0,a.jsx)(c.A,{className:"mr-2 h-4 w-4"}),"Test"]}),(0,a.jsxs)(h.$,{variant:"outline",size:"sm",onClick:()=>F.mutate(),disabled:F.isPending,children:[F.isPending?(0,a.jsx)(m.A,{className:"mr-2 h-4 w-4 animate-spin"}):R.is_active?(0,a.jsx)(x.A,{className:"mr-2 h-4 w-4"}):(0,a.jsx)(u.A,{className:"mr-2 h-4 w-4"}),R.is_active?"Deactivate":"Activate"]}),(0,a.jsxs)(h.$,{size:"sm",onClick:()=>{if(!R)return;let e={nodes:k,start_node_id:R.start_node_id};T.mutate(e)},disabled:!_||T.isPending,children:[T.isPending?(0,a.jsx)(m.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,a.jsx)(p.A,{className:"mr-2 h-4 w-4"}),"Save"]})]})]}),(0,a.jsxs)("div",{className:"flex flex-1 overflow-hidden",children:[(0,a.jsx)(ef,{onAddNode:e=>{let s={id:"node-".concat(Date.now()),type:e,content:"end"===e?"":"New node content...",transitions:[],position:{x:250,y:(k.length+1)*150}};"question"===e&&(s.quick_replies=[{id:"option-1",title:"Option 1"},{id:"option-2",title:"Option 2"}]),"action"===e&&(s.actions=[{type:"tag",config:{tag:"new-tag"}}]),C([...k,s]),A(s.id),E(!0)}}),(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)(I,{nodes:k,startNodeId:R.start_node_id,selectedNodeId:y,onNodesChange:P,onNodeSelect:e=>{A(e)}})}),D&&(0,a.jsx)(Z,{node:D,allNodes:k,onUpdate:e=>{C(k.map(s=>s.id===e.id?e:s)),E(!0)},onDelete:()=>$(D.id),onClose:()=>A(null)})]}),(0,a.jsx)(eu,{flowId:v,open:q,onOpenChange:S})]}):(0,a.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h2",{className:"text-lg font-medium",children:"Flow not found"}),(0,a.jsx)(h.$,{variant:"link",onClick:()=>s.push("/flows"),children:"Back to flows"})]})})}},33900:(e,s,t)=>{"use strict";t.d(s,{p:()=>d});var a=t(95155),l=t(12115),n=t(31027),i=t(21567);let r=(0,n.F)("flex w-full rounded-md border bg-background px-3 py-2 text-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",{variants:{variant:{default:"border-input",terminal:"border-primary/50 bg-background font-mono focus:border-primary",error:"border-destructive focus-visible:ring-destructive"},inputSize:{default:"h-10",sm:"h-9 text-xs",lg:"h-11"}},defaultVariants:{variant:"default",inputSize:"default"}}),d=l.forwardRef((e,s)=>{let{className:t,variant:l,inputSize:n,type:d,error:o,leftIcon:c,rightIcon:m,...x}=e,u=o?"error":l;return c||m?(0,a.jsxs)("div",{className:"relative",children:[c&&(0,a.jsx)("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground",children:c}),(0,a.jsx)("input",{type:d,className:(0,i.cn)(r({variant:u,inputSize:n}),c&&"pl-10",m&&"pr-10",t),ref:s,...x}),m&&(0,a.jsx)("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground",children:m})]}):(0,a.jsx)("input",{type:d,className:(0,i.cn)(r({variant:u,inputSize:n,className:t})),ref:s,...x})});d.displayName="Input"},98986:(e,s,t)=>{"use strict";t.d(s,{J:()=>o});var a=t(95155),l=t(12115),n=t(46195),i=t(31027),r=t(21567);let d=(0,i.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),o=l.forwardRef((e,s)=>{let{className:t,required:l,children:i,...o}=e;return(0,a.jsxs)(n.b,{ref:s,className:(0,r.cn)(d(),t),...o,children:[i,l&&(0,a.jsx)("span",{className:"ml-1 text-destructive",children:"*"})]})});o.displayName=n.b.displayName},77995:(e,s,t)=>{"use strict";t.d(s,{F:()=>r});var a=t(95155),l=t(12115),n=t(95467),i=t(21567);let r=l.forwardRef((e,s)=>{let{className:t,children:l,...r}=e;return(0,a.jsxs)(n.bL,{ref:s,className:(0,i.cn)("relative overflow-hidden",t),...r,children:[(0,a.jsx)(n.LM,{className:"h-full w-full rounded-[inherit]",children:l}),(0,a.jsx)(d,{}),(0,a.jsx)(n.OK,{})]})});r.displayName=n.bL.displayName;let d=l.forwardRef((e,s)=>{let{className:t,orientation:l="vertical",...r}=e;return(0,a.jsx)(n.VM,{ref:s,orientation:l,className:(0,i.cn)("flex touch-none select-none transition-colors","vertical"===l&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===l&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",t),...r,children:(0,a.jsx)(n.lr,{className:"relative flex-1 rounded-full bg-border"})})});d.displayName=n.VM.displayName},37528:(e,s,t)=>{"use strict";t.d(s,{bq:()=>x,eb:()=>f,gC:()=>h,l6:()=>c,yv:()=>m});var a=t(95155),l=t(12115),n=t(58012),i=t(51719),r=t(91902),d=t(98867),o=t(21567);let c=n.bL;n.YJ;let m=n.WT,x=l.forwardRef((e,s)=>{let{className:t,children:l,...r}=e;return(0,a.jsxs)(n.l9,{ref:s,className:(0,o.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...r,children:[l,(0,a.jsx)(n.In,{asChild:!0,children:(0,a.jsx)(i.A,{className:"h-4 w-4 opacity-50"})})]})});x.displayName=n.l9.displayName;let u=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(n.PP,{ref:s,className:(0,o.cn)("flex cursor-default items-center justify-center py-1",t),...l,children:(0,a.jsx)(r.A,{className:"h-4 w-4"})})});u.displayName=n.PP.displayName;let p=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(n.wn,{ref:s,className:(0,o.cn)("flex cursor-default items-center justify-center py-1",t),...l,children:(0,a.jsx)(i.A,{className:"h-4 w-4"})})});p.displayName=n.wn.displayName;let h=l.forwardRef((e,s)=>{let{className:t,children:l,position:i="popper",...r}=e;return(0,a.jsx)(n.ZL,{children:(0,a.jsxs)(n.UC,{ref:s,className:(0,o.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border border-border bg-card text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===i&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:i,...r,children:[(0,a.jsx)(u,{}),(0,a.jsx)(n.LM,{className:(0,o.cn)("p-1","popper"===i&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:l}),(0,a.jsx)(p,{})]})})});h.displayName=n.UC.displayName,l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(n.JU,{ref:s,className:(0,o.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",t),...l})}).displayName=n.JU.displayName;let f=l.forwardRef((e,s)=>{let{className:t,children:l,...i}=e;return(0,a.jsxs)(n.q7,{ref:s,className:(0,o.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...i,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(n.VF,{children:(0,a.jsx)(d.A,{className:"h-4 w-4"})})}),(0,a.jsx)(n.p4,{children:l})]})});f.displayName=n.q7.displayName,l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(n.wv,{ref:s,className:(0,o.cn)("-mx-1 my-1 h-px bg-muted",t),...l})}).displayName=n.wv.displayName},15157:(e,s,t)=>{"use strict";t.d(s,{w:()=>r});var a=t(95155),l=t(12115),n=t(90434),i=t(21567);let r=l.forwardRef((e,s)=>{let{className:t,orientation:l="horizontal",decorative:r=!0,...d}=e;return(0,a.jsx)(n.b,{ref:s,decorative:r,orientation:l,className:(0,i.cn)("shrink-0 bg-border","horizontal"===l?"h-[1px] w-full":"h-full w-[1px]",t),...d})});r.displayName=n.b.displayName},46754:(e,s,t)=>{"use strict";t.d(s,{T:()=>i});var a=t(95155),l=t(12115),n=t(21567);let i=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)("textarea",{className:(0,n.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:s,...l})});i.displayName="Textarea"}},e=>{var s=s=>e(e.s=s);e.O(0,[8946,3862,2361,8233,7778,9556,3454,7866,1667,384,6393,9299,3402,4580,8441,1517,7358],()=>s(24059)),_N_E=e.O()}]);